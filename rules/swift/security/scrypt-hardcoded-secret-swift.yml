id: scrypt-hardcoded-secret-swift
language: swift
severity: warning
message: >-
  A secret is hard-coded in the application. Secrets stored in source
  code, such as credentials, identifiers, and other types of sensitive data,
  can be leaked and used by internal or external malicious actors. Use
  environment variables to securely provide credentials and other secrets or
  retrieve them from a secure vault or Hardware Security Module (HSM).
note: >-
  [OWASP A07:2021]:Identification and Authentication Failures
  [CWE-798]: Use of Hard-coded Credentials
  [REFERENCES]
       https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
utils:
  match_property_declaration:
    kind: property_declaration
    all:
      - has:
          stopBy: end
          kind: call_expression
          has:
            stopBy: end
            kind: value_argument
            all:
              - has:
                  stopBy: end
                  kind: simple_identifier
                  field: name
                  regex: "^password$"
              - has:
                  stopBy: end
                  kind: simple_identifier
                  field: value
                  pattern: $R
      - follows:
          stopBy: end
          kind: property_declaration
          has:
            stopBy: end
            kind: pattern
            has:
              kind: simple_identifier
              pattern: $R
  match_call_expression:
    kind: call_expression
    has:
      stopBy: end
      kind: navigation_expression
      has:
        stopBy: end
        kind: value_argument
        all:
          - has:
              stopBy: end
              kind: simple_identifier
              regex: "^password$"
          - has:
              stopBy: end
              kind: line_string_literal
              has:
                stopBy: end
                kind: line_str_text
rule:
  any:
    - matches: match_property_declaration
    - matches: match_call_expression
