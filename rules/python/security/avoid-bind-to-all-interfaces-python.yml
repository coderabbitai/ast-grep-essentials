id: avoid-bind-to-all-interfaces-python
severity: warning
language: python
message: >-
  Running `socket.bind` to 0.0.0.0, or empty string could unexpectedly
  expose the server publicly as it binds to all available interfaces.
  Consider instead getting correct address from an environment variable or
  configuration file.
note: >-
  [CWE-200] Exposure of Sensitive Information to an Unauthorized Actor.
  [REFERENCES]
      - https://owasp.org/Top10/A01_2021-Broken_Access_Control
utils:
  MATCH_PATTERN_$S.bind:
    kind: expression_statement
    all:
      - has:
          stopBy: neighbor
          kind: call
          all:
            - has:
                stopBy: neighbor
                kind: attribute
                all:
                  - has:
                      stopBy: neighbor
                      kind: identifier
                  - has:
                      stopBy: neighbor
                      kind: identifier
                      regex: "^bind$"
            - has:
                stopBy: neighbor
                kind: argument_list
                has:
                  stopBy: neighbor
                  kind: tuple
                  has:
                    stopBy: neighbor
                    kind: string
                    regex: ^'0.0.0.0'|'::'|''$
      - follows:
          stopBy: end
          kind: expression_statement
          has:
            stopBy: end
            kind: call
            has:
              stopBy: neighbor
              kind: attribute
              all:
                - has:
                    stopBy: neighbor
                    kind: identifier
                    regex: "^socket$"
                - has:
                    stopBy: neighbor
                    kind: identifier
                    regex: "^socket$"

rule:
  kind: expression_statement
  any:
    - matches: MATCH_PATTERN_$S.bind
