id: avoid-crypto-rc4-typescript
severity: warning
language: typescript
message: >-
  Avoid RC4 encryption. Use of the RC4 security protocol exposes your 
  application to vulnerabilities. Consider using stronger encryption algorithms.
note: >-
  [CWE-328] Use of Weak Hash.
  [REFERENCES]
      - https://cryptojs.gitbook.io/docs/#ciphers
ast-grep-essentials: true
utils:
  MATCH_RC4_USAGE:
    kind: call_expression
    has:
      stopBy: neighbor
      kind: member_expression
      all:
        - has:
            stopBy: neighbor
            kind: member_expression
            all:
              - has:
                  stopBy: neighbor
                  kind: identifier
                  regex: "^CryptoJS$"
              - has:
                  stopBy: neighbor
                  kind: property_identifier
                  any:
                    - regex: "^RC4$"
                    - regex: "^RC4Drop$"
        - has:
            stopBy: neighbor
            kind: property_identifier
            any:
              - regex: "^encrypt$"
              - regex: "^decrypt$"
rule:
  kind: call_expression
  any:
    - matches: MATCH_RC4_USAGE
