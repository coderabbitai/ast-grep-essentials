id: avoid-des-typescript
severity: warning
language: typescript
message: >-
  Do not use DES or TripleDES, this is a weak security protocol. Use stronger 
  encryption algorithms like AES instead.
note: >-
  [CWE-328] Use of Weak Hash.
  [REFERENCES]
      - https://cryptojs.gitbook.io/docs/#ciphers
ast-grep-essentials: true
utils:
  MATCH_DES_USAGE:
    kind: call_expression
    has:
      stopBy: neighbor
      kind: member_expression
      all:
        - has:
            stopBy: neighbor
            kind: member_expression
            all:
              - has:
                  stopBy: neighbor
                  kind: identifier
                  regex: "^CryptoJS$"
              - has:
                  stopBy: neighbor
                  kind: property_identifier
                  any:
                    - regex: "^DES$"
                    - regex: "^TripleDES$"
        - has:
            stopBy: neighbor
            kind: property_identifier
            any:
              - regex: "^encrypt$"
              - regex: "^decrypt$"
rule:
  kind: call_expression
  any:
    - matches: MATCH_DES_USAGE
